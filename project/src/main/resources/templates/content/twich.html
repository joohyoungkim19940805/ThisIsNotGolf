<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>주폭도는 풀 수 있는 문제 ♥</title>
<link rel="icon" type="image/x-icon" th:href="@{images/favicon.ico}"/>
<link th:href="@{css/common.css}" rel="stylesheet" />
<script type="text/javascript" th:src="@{js/client/ModalLoader.js}"></script>
<script type="text/javascript" th:src="@{js/client/GameSettingView.js}"></script>
<script type="text/javascript" th:src="@{js/client/Questions.js}"></script>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
<script type="text/javascript" th:src="@{js/client/meshwriter.min.js}"></script>
<style>
	span.chat_id:after {
    	content: " : ";
	}
	label.questions_user_select:after{
		content: "번 : ";
	}
	span.questions_user_select_number:after{
		content:"명";
	}
	.bottom_wrap_fadeout{
		animation : fadeout 200ms linear forwards;
	}
	.bottom_wrap_fadein{
		animation : fedein 200ms linear forwards;
	}
	@keyframes fadeout{
		0%{height: 6vh;}
		20%{height: 4.8vh;}
		40%{height: 3.6vh;}
		60%{height: 2.4vh;}
		80%{height: 1.2vh;}
		100%{height: 0vh; visibility: hidden;}
	}
	@keyframes fedein{
		0%{height: 0vh;}
		20%{height: 1.2vh;}
		40%{height: 2.4vh;}
		60%{height: 3.6vh;}
		80%{height: 4.8vh;}
		100%{height: 6vh;}
	}
	.bottom_button{
		height: 65%;
	    background-color: #772ce8;
	    color: #fff;
	    border-radius: 15%;
	}
	.bottom_button:hover{
		color: #26ffbb;
	}
	.bottom_button_list{
		text-align: -webkit-center;
	    display: flex;
	    justify-content: center;
	    gap: 22vw;
	    align-items: center;
	}
	.time_wrapper.not_timer_image{
		background-color: #7546728c;
	}	
	.time_wrapper.not_timer_image span.time_separator:after{
		content:" :";
	}
	.time_wrapper.not_timer_image span.time_separator_seconds:after{
		content:" .";
	}
	.menu_component{
		background-color: #ffffff26;
		width: auto;
		text-align: -webkit-center;
		text-align: center;
		border-radius: 8%;
	}
	.menu_component button{
		color: #0031ad;
	}
	.video_question_select{
		width:30%;
		height:10%;
	}
	.chat_questions_view_item_wrapper{
		width: 50%;
		display: grid;
		align-items: center;
		font-size: 1.2vmax;
		font-weight: bold;
	}
	.chat_questions_chart{
		width: 65%;
		height: 2vh;
	}
	.chat_questions_chart > .chat_questions_chart_graph{
		height: 100%;
	}
	.chat_questions_chart_statistics_wrapper{
		display:'flex'; 
		align-items:'center';
	}
</style>
<script type="text/javascript">
	const randomColor = ['#ffffff','#fff5ee','#fffafa','#f8f8ff','#fffaf0','#f5f5f5','#f0f8ff','#f0ffff','#fdf5e6','#f5fffa','#ffefd5','#ffdab9','#faf0e6','#eee8aa','#ffe4e1','#ffe4b5','#ffdead','#d2b48c','#f5deb3','#fafad2','#ffffe0','#fff8dc','#faebd7','#f5f5dc','#fffacd','#fffff0','#f0e68c','#e6e6fa','#fff0f5','#ffe4c4','#ffebcd','#deb887','#cd853f','#00ced1','#00bfff','#7fffd4','#1e90ff','#00ffff','#f0fff0','#87cefa','#afeeee','#e0ffff','#add8e6','#b0c4de','#40e0d0','#48d1cc','#00ffff','#b0e0e6','#87ceeb','#4169e1','#ff00ff','#ff00ff','#c71585','#dc143c','#ff1493','#ffb6c1','#ff69b4','#ffc0cb','#dda0dd','#ee82ee','#d8bfd8','#da70d6','#a52a2a','#e9967a','#f08080','#cd5c5c','#ffa07a','#db7093','#f4a460','#fa8072','#ff6347','#ff4500','#ff0000','#b22222','#d2691e','#bc8f8f','#ff7f50','#ff8c00','#ffa500','#b8860b','#ffd700','#ffff00','#7fff00','#7cfc00','#00ff00','#32cd32','#00ff7f','#3cb371','#adff2f','#8fbc8f','#90ee90','#98fb98','#2e8b57','#00fa9a','#20b2aa','#66cdaa','#6b8e23','#bdb76b','#daa520'];
	const getRandomColor = () => randomColor[Math.floor( Math.random() * (Math.floor(randomColor.length-1))) ];
	const questions = new Questions();
	var webSocket;
	const setting = {
		chatYn : true,
		timerYn : true,
		backgroundImage : [`url('images/jululu_background_image_night.png')`, `url('images/jululu_background_image.png')`],
		isStartGame : false,
		gameSelectKey : -1,
		questionsRecord : {},
		nowQuestionsInfo : {},
		nowQuestionsTotalCount : 0,
		chatSeparator : 'ㄹ',
		devQuestions : {
			questionsList : questions.devQuestions,
			pageMax : 1,
			page : 1,
			type : 0,
			answers : questions.devAnswer,
		},
		cottonQuestions : {
			questionsList : [],
			pageMax : 1,
			page : 1,
			type : 1,
			answers : [],
		},
		twentyHills :{
			questionsCount : 0,
			answer : '',
			type : 2,
		},
		thisPageIsExist : function(page, obj){
			console.log(obj);
			console.log(page);
			console.log(typeof page)
			console.log(obj.filter(e=>e.hasOwnProperty(page)).length == obj.length)
			return obj.filter(e=>e.hasOwnProperty(page)).length == obj.length;
		}
	}
	window.addEventListener('load',() => {
		modalLoader = new ModalLoader();
		modalLoader.setModalAlert();
		chatContentArr = document.querySelector('#chat_message_content');
	    timer = new Timer(document.querySelector('.time_wrapper'));
	    timer.setNow();
	    
		webSocket = new WebSocket(`ws://${location.host}/room/twich`);
		webSocket.onopen = function () {
		};
	    webSocket.onmessage = function (event) { 
	        let data = JSON.parse(event.data);
	    	if(data.hasOwnProperty('chat')){
	        	if(setting.chatYn){
		        	chatContentTemplate(data.chat).then(chatElement=>messageViewLoder(chatElement))
		        								.then(chatWrapCount=>chatControl(chatWrapCount))
	        	}
	        	//console.log(data.chat)
	        	checkGameChatFilter(data.chat).then((chatInfo)=>chatQuestionsMapperFilter(chatInfo))
	        								.then((chatInfo)=>chatStatistics(chatInfo));
	        }else if(data.hasOwnProperty('subscription')){
	        	console.log(data);
	        }else if(data.hasOwnProperty('follow')){
	        	console.log(data);	
	        }else if(data.hasOwnProperty('donation')){
	        	console.log(data);
	        }
	    };

	    const chatContentTemplate = ({message, user}) => {
			return new Promise(resolve =>
						setTimeout(resolve(
											[Object.assign(document.createElement('span'), {className : 'chat_id', textContent : user}), 
											Object.assign(document.createElement('span'),{className : 'chat_message', textContent : message})]
											)), 1);
		}
    	const messageViewLoder = (chatElement) => {
	    	return new Promise(resolve =>{
		    	if(chatContentArr){
					let div = document.createElement('div');
					chatElement.forEach(e=>e.style.color = getRandomColor())
					div.append(...chatElement);
					chatContentArr.append(div);
				}
				return setTimeout(resolve(chatContentArr.childElementCount), 1);
	    	});
		}
	    const chatControl = (chatWrapCount) => {
	    	if(chatWrapCount >= 200){
	    		chatContentArr.removeChild(chatContentArr.firstElementChild);
	    	}
	    	chatContentArr.scrollTop = chatContentArr.scrollHeight;
	    }
	    
	    const checkGameChatFilter = (chatInfo) => {
	    	return new Promise(resolve =>{
		    	if(timer.isCustomRun && canvas.getAttribute('is_canvas_run') === 'Y' && chatInfo.message.charAt(0) === setting.chatSeparator){
		    		return setTimeout(resolve(chatInfo), 1);
		    	}
				return setTimeout(resolve(''), 1);
	    	});
	    }
	    
	    const chatQuestionsMapperFilter = (chatInfo) => {
	    	return new Promise(resolve =>{
		    	if(chatInfo !== '' && setting.nowQuestionsInfo.hasOwnProperty(chatInfo.message.substring(1))){
		    		return setTimeout(resolve(chatInfo), 1);
		    	}
				return setTimeout(resolve(''), 1);
	    	});
	    }
	    
	    const chatStatistics = (chatInfo) => {
	    	return new Promise(resolve =>{
	    		if(chatInfo !== ''){
		    		let message = chatInfo.message.substring(1);
		    		let targetObject = setting.nowQuestionsInfo[message];
		    		
		    		targetObject.userSelectCount++;
		    		targetObject.userSelectCountHTML.textContent = targetObject.userSelectCount;
		    		setting.nowQuestionsTotalCount += targetObject.userSelectCount;
		    		
		    		
		    		
		    		targetObject.chartValue = targetObject.userSelectCount / setting.nowQuestionsTotalCount
		    		targetObject.chartValueHTML.style.width = `${targetObject.chartValue * 100}%`
	    		}
				return setTimeout(resolve(''), 1);
	    	});
	    }
	});

    class Timer{
    	constructor(timerElement){
    		this.second = Object.freeze(1000);
    		this.minute = Object.freeze(this.second * 60);
    		this.hour = Object.freeze(this.minute * 60);
    		this.timerInterval;
    		this.timerElement = timerElement;
    		this.isCustomRun = false;
    		this.inputMinute = 0;
    	}
    	
    	setCustomTimer(objOffsetParent){
    		this.inputMinute = objOffsetParent.querySelector('.timer_setting_input_block input').value
    		if(this.inputMinute == 0){
    			modalLoader.createModalAlertText(['시간을 선택해주세요(분 단위 입력)']);
    			return false;
    		}
    		
    		objOffsetParent.style.display = 'none';
    		createChatWrapper();
    		this.clear();
    		this.isCustomRun = true;
    		this.timerElement.style.display = 'flex';
    		let endTime = (Number(this.inputMinute) * this.minute) + new Date().getTime();
    		this.timerInterval = setInterval(()=>{
	    		let ms = endTime - new Date().getTime();
			    if(ms <= 0){
		    		this.isCustomRun = false;
			    	this.setTimerDefult();
			    	modalLoader.createModalAlertText(['타이머 종료']);
			    	return false;
			    }
	    		this.timerElement.querySelector('.hour').textContent = `${Math.floor( ms / this.hour )}`.padStart(2,'0');
			    this.timerElement.querySelector('.minute').textContent = `${Math.floor( ms % this.hour / this.minute )}`.padStart(2,'0');
			    this.timerElement.querySelector('.seconds').textContent = `${Math.floor( ms % this.minute / this.second )}`.padStart(2,'0');
			    this.timerElement.querySelector('.millisecond').textContent = `${ ms % this.second }`.padStart(2,'0').slice(0, 2);
    		},60);
    	}
    	setNow(){
    		this.clear();
    		this.timerElement.style.display = 'flex';
    		this.isCustomRun = false;
    		this.timerInterval = setInterval(()=>{
	    		let now = new Date()
	    		this.timerElement.querySelector('.hour').textContent = `${ now.getHours() }`.padStart(2,'0');
	    		this.timerElement.querySelector('.minute').textContent = `${ now.getMinutes() }`.padStart(2,'0');
	    		this.timerElement.querySelector('.seconds').textContent = `${ now.getSeconds() }`.padStart(2,'0');
	    		this.timerElement.querySelector('.millisecond').textContent = `${ Math.floor(now.getMilliseconds()) }`.padStart(2,'0').slice(0, 2);
    		}, 60);
    	}
    	clear(){
    		this.isCustomRun = false;
    		clearInterval(this.timerInterval)
    		this.timerElement.style.display = 'none';
    	}
    	toggle(){
    		setting.timerYn = !setting.timerYn;
    		if(setting.timerYn){
    			this.setNow();
    		}else{
    			this.clear();
    		}
    	}
    	setTimerDefult(){
    		this.isCustomRun = false;
    		clearInterval(this.timerInterval)
    		this.timerElement.querySelector('.hour').textContent = '00'
    		this.timerElement.querySelector('.minute').textContent = '00'
    		this.timerElement.querySelector('.seconds').textContent = '00'
    		this.timerElement.querySelector('.millisecond').textContent = '00'
    	}
    	
    }
</script>
</head>
<body style="height: 100%; min-height: 100%;" oncontextmenu="return false">>
	<div id="all_content_wrap" style="background-image: url('images/jululu_background_image_night.png'); 
		background-repeat: no-repeat;
    	background-size: 100% 100%;position:absolute; top:0; bottom:0; right:0; left:0;
    	display: grid; align-content: space-around;
    	justify-content: end;">
    	<!-- 
		<div class="top_button_wrapper" style="text-align: -webkit-center; position: absolute; top: 0; width: 100%;">
			<div class="top_show_hide_wrap">
				<button class="top_show_hide" type="button"></button>
			</div>
			<div class="top_button_list"></div>
		</div>
		-->
		<div class="time_wrapper" style="position: absolute;display: flex;bottom: 11.4vh;right: 21.8vw;gap: 1.2vw;font-size: 3vmax;color: white;align-items: flex-end;width: 16vw;height: 8vh">
            <span class="hour time_separator">00</span>
            <span class="minute time_separator">00</span>
            <span class="seconds time_separator_seconds">00</span>
            <span class="millisecond" style="font-size: 2.3vmax;">00</span>
        </div>
		<main class="maim_content">
			<div id="chat_message_content" class="chat_content" style="width:22vw; height:56vh; margin-right: 7vw;
				overflow-y: hidden; overflow-x: hidden; overflow-wrap: break-word;
				border: none; ">
		
			</div>
		</main>
		<div class="bottom_button_wrapper" style="text-align: -webkit-center; position: absolute; bottom: 0; width: 100%;">
			<div class="bottom_show_hide_wrap" onclick="this.nextElementSibling.classList.value.includes('bottom_wrap_fadeout') ? 
															this.nextElementSibling.classList.replace('bottom_wrap_fadeout','bottom_wrap_fadein') : 
															this.nextElementSibling.classList.replace('bottom_wrap_fadein','bottom_wrap_fadeout') ; 
														this.children[0].classList.toggle('direction_down');"
												style="display: flex; justify-content: center;
													  align-items: flex-start; background-color: #fff5f524;
													  align-content: stretch; border-top-left-radius: 100%;
													  border-top-right-radius: 100%;
													  width: 100%;">
				<i class="bottom_show_hide arrow direction_up"></i>
			</div>
			<div class="bottom_button_list bottom_wrap_fadein">
				<button id="game_start_button"type="button" class="bottom_button" onclick="startGame(this);">게임시작</button>
				<button type="button" class="bottom_button" onclick="document.querySelector('#game_select_layer').style.display='flex'">게임 선택</button>
				<button type="button" class="bottom_button" onclick="document.querySelector('#timer_setting_layer').style.display='flex'">타이머 설정</button>
				<button type="button" class="bottom_button" onclick="document.querySelector('#option_layer').style.display='flex'">설정</button>
			</div>
		</div>
		
		<!-- layer -->
		<div id="option_layer" style="position: absolute;width: 100%;height: 100%;display: none;background-color: rgba(240, 248, 255, 0.29);opacity: 1;justify-content: center;align-items: center; top: 0; left: 0; z-index:2;">
			<script>
				document.querySelector('#option_layer').onclick = function(e) {
					return e.path[0] === this ? this.style.display = 'none' : false
				}
			</script>
			<div class="option_menu" style="width: 13%;height: 33%;display: grid;background-color: #ffbad6d1;align-items: center;align-content: space-evenly;justify-items: center;border-radius: 100%;">
			    <div class="menu_component">
			    	<button type="button" class="option_menu_button" onclick="chatOnOff(this);" style="color: #0031ad;">채팅 ON</button>
			    	<script type="text/javascript">
			    		function chatOnOff(obj){
			    			obj.classList.toggle('OFF');
			    			if(obj.classList.value.includes('OFF')){
			    				obj.textContent = '채팅 OFF';
			    				chatContentArr.style.display='none';
			    			}else{
			    				obj.textContent = '채팅 ON';
			    				chatContentArr.style.display='block';
			    			}
			    			setting.chatYn = !setting.chatYn;
			    			
			    		}
			    	</script>
			    </div>
			    <div class="menu_component">
			    	<button type="button" class="option_menu_button" onclick="timer.toggle(); setting.timerYn ? this.textContent='시계 ON' : this.textContent='시계 OFF'">시계 ON</button>
			    </div>
			    <div class="menu_component">
			    	<button type="button" class="option_menu_button" background_image_index="0" onclick="backgroundImageChange(this);">배경 1</button>
			    	<script type="text/javascript">
			    		function backgroundImageChange(obj){
			    			let backgroundImageIndex = Number(obj.attributes.background_image_index.value) + 1;
			    			backgroundImageIndex = setting.backgroundImage.some((e,i)=>i==backgroundImageIndex) ? backgroundImageIndex : 0
			    			obj.attributes.background_image_index.value = backgroundImageIndex;
			    			document.querySelector('#all_content_wrap').style.backgroundImage = setting.backgroundImage[backgroundImageIndex];
			    			obj.textContent = `배경 ${backgroundImageIndex + 1}`;
			    			if(backgroundImageIndex != 0){
			    				timer.timerElement.classList.add('not_timer_image')
			    			}else{
			    				timer.timerElement.classList.remove('not_timer_image')
			    			}
			    		}
			    	</script>
			    </div>
			    <div class="menu_component">
			    	<button type="button" class="option_menu_button">미구현3</button>
			    </div>
			    <div class="menu_component">
			    	<button type="button" class="option_menu_button">미구현4</button>
			    </div>
			</div>
		</div>
		
		<div id="timer_setting_layer" style="position: absolute;width: 100%;height: 100%;display: none;background-color: rgba(240, 248, 255, 0.29);opacity: 1;justify-content: center;align-items: center; top: 0; left: 0; z-index:2;">
			<script type="text/javascript">
				document.querySelector('#timer_setting_layer').onclick = function(e) {
					return e.path[0] === this ? this.style.display = 'none' : false
				}
			</script>
			<div class="timer_setting_menu" style="width: 33%;height: 33%;display: grid;background-color: #81efe7d1;align-items: center;align-content: space-evenly;justify-items: center;border-radius: 10%;">
				<div class="timer_setting_input_block" style="width: 100%;text-align: center;text-align: -webkit-center;">
					<input type="number" min="1" placeholder="분 단위" step="0.01" style="width: 50%;">
					<script type="text/javascript">
						document.querySelector('.timer_setting_input_block > input').onkeyup = function(e){
							if(e.key==='Enter'){
								this.blur();
								timer.setCustomTimer(this.value);
							}else{
								return false; 
							}
						}
					</script>
				</div>
				<div class="timer_setting_menu_wrap" style="display: flex;justify-content: space-around;width: 100%;">
					<div class="menu_component" style="width:auto;">
			    		<button type="button" class="option_menu_button" onclick="timer.setCustomTimer(this.offsetParent);">타이머 시작</button>
					</div>
					<div class="menu_component" style="width:auto;">
			    		<button type="button" class="option_menu_button" onclick="timer.setTimerDefult();">타이머 초기화</button>
					</div>
					<div class="menu_component" style="width:auto;">
			    		<button type="button" class="option_menu_button" onclick="timer.setNow();">시계로 변경</button>
					</div>
				</div>
			</div>
		</div>
		
		<div id="game_select_layer" style="position: absolute;width: 100%;height: 100%;display: none;background-color: rgba(240, 248, 255, 0.29);opacity: 1;justify-content: center;align-items: center; top: 0; left: 0; z-index:2;">
			<script type="text/javascript">
				document.querySelector('#game_select_layer').onclick = function(e) {
					return e.path[0] === this ? this.style.display = 'none' : false
				}
			</script>
			<div class="game_select_menu" style="width: 22%;height: 49%;display: grid;background-color: #db5dffde;align-items: center;align-content: space-evenly;justify-items: center;border-radius: 10%;">
				<div class="menu_component" style="width:auto;">
		    		<button type="button" class="option_menu_button" onclick="setting.gameSelectKey='devQuestions';gameSelectEvent(this);">주폭도는 풀 수 있는 개발자의 10선 문제</button>
				</div>
				<div class="menu_component" style="width:auto;">
		    		<button type="button" class="option_menu_button" onclick="setting.gameSelectKey='cottonQuestions';gameSelectEvent(this)">르르땅이 만드는 이심전심 문제풀이</button>
				</div>
				<!-- 
				<div class="menu_component" style="width:auto;">
		    		<button type="button" class="option_menu_button" onclick="setting.gameSelectKey='twentyHills';gameSelectEvent(this)">주폭도와 함께하는 온라인 스무고개</button>
				</div>
				-->
			</div>
			<script type="text/javascript">
				function gameSelectEvent(obj){
					if(setting.gameSelectType == - 1){
						modalLoader.createModalAlertText(['게임을 선택해주세요.']);
						return;
					}else if(setting.gameSelectKey === 'cottonQuestions'){
						document.querySelector('#cotton_questions').style.display='grid';
					}else {
						startGame(document.querySelector('#game_start_button'));
					}
					obj.offsetParent.style.display = 'none';
					reloadScene();
					//setting[gameSelectKey];
					//cottonQuestions
				}
			</script>
		</div>
		
		<div id="cotton_questions" style="position: absolute;width: 100%;height: 100%;display: none;background-color: rgba(240, 248, 255, 0.29);opacity: 1;justify-content: center;align-items: center;top: 0px;left: 0px;z-index: 2;align-content: space-between;padding-top: 5%;">
			<div class="cotton_questions_wrapper" style="width: 41vw;display: grid;gap: 2%;">
				<a href="javascript:void(0);" style="margin-left: 96%;font-size: 2vmax;background-color: white;text-align: center;" onclick="this.offsetParent.style.display='none';">
					X
				</a>
				<div class="cotton_questions_content" style="display: grid;width: 100%;text-align: center;text-align: -webkit-center;gap: 5%; height: 47vh;">
					<input id="title" class="cotton_input_questions_content" data-empty_message="제목 내용" type="text" min="1" placeholder="제목" step="0.01" maxlength="43" style="width: 100%;">
					<textarea id="questions" class="cotton_input_questions_content" data-empty_message="문제 내용"rows="13" cols="37" placeholder="문제 내용 (500글자 제한) &#13;&#10; *주의사항)줄바꿈을 기준으로 문항을 인식합니다.&#13;&#10;엔터 열번 누르면 10문항으로 만들어집니다.&#13;&#10;문항마다 숫자는 자동으로 붙습니다. &#13;&#10; 예시) &#13;&#10;주르르는 500이다. => 1. 주르르는 500이다.&#13;&#10;주르르는 600이다. => 2. 주르르는 600이다.&#13;&#10;주르르는 700이다. => 3. 주르르는 700이다." style="font-size: 1vmax;font-weight: bold;" maxlength="500"></textarea>
					<div id="answer_wrapper" style="display: flex;flex-direction: row-reverse;align-items: center;justify-content: space-evenly;">
						<input id="answer" class="cotton_input_questions_content" data-empty_message="정답 내용"type="text" min="1" placeholder="정답 내용" step="0.01" style="width: 50%;">
						<label style="background: white;font-size: 1vmax;font-family: cursive;">
							정답 내용 숨기기
							<input type="checkbox" onclick="this.checked === true ? 
																this.offsetParent.querySelector('#answer').style.color = 'transparent' : 
																this.offsetParent.querySelector('#answer').style.color = 'black' "/>
						</label>
					</div>
				</div>
				<div class="cotton_questions_button_wrapper" style="display: flex; justify-content: space-between;">
					<div class="questions_cancel_wrapper" style="display: flex; gap: 28%;">
			    		<button type="button" class="bottom_button" onclick="" style="height:100%">이 문제 초기화</button>
			    		<button type="button" class="bottom_button" onclick="" style="height:100%">전체 문제 초기화</button>
					</div>
					<div class="questions_regist_wrapper" style="display: flex;">
			    		<button type="button" class="bottom_button" onclick="cottonQuestionsRegister(this); reloadScene();" style="height:100%">등록하기</button>
			    		<script type="text/javascript">
			    			function cottonQuestionsRegister(obj){
			    				let questionsWrapper = obj.offsetParent;
			    				let questionsContent = questionsWrapper.querySelector('.cotton_questions_content');
			    				let title = questionsContent.querySelector('input#title');
			    				let questionsArr = questionsContent.querySelector('textarea#questions');
			    				let answer = questionsContent.querySelector('input#answer');
			    				
			    				let nowPage = questionsWrapper.querySelector('#cotton_questions_page');
				    			let maxPage = questionsWrapper.querySelector('#cotton_questions_max_page');
				    			let nowPageValue = Number(nowPage.textContent);
				    			let maxPageValue = Number(maxPage.textContent);
			    				
				    			let thisPageIsExist = setting.thisPageIsExist(nowPageValue -1, [setting.cottonQuestions.questionsList, setting.cottonQuestions.answers]);
				    			
			    				if(title.value.length === 0 || questionsArr.value.length === 0 || answer.value.length ===0){
			    					let alertMessage = ['입력되지 않은 내용이 있습니다.']
			    					alertMessage.push(...[...questionsContent.querySelectorAll('.cotton_input_questions_content')].filter(e=>e.value.length == 0).map(e=>`*${e.dataset.empty_message}*`));
			    					modalLoader.createModalAlertText(alertMessage);
			    					return false;
			    				}
			    				
			    				let resultQuestions = `${title.value}\n${questionsArr.value}`.split('\n').reduce((list,item,index)=>{ 
			    					if( thisPageIsExist == false || `${item.charAt(0)}${item.charAt(1)} ` == `${index}. ` == false){
				    					index == 0 ? 
	    										item = item : 
	    										item = `${index}. ${item}`;
			    					}
									if(item.length > 42){
			    				        let str;
			    				        while(str !== '' ){
			    				            str = item.substring(0,42)
			    				            if(str !== ''){
			    				            	list.push(str);
			    				            }
			    				            item = item.substring(43);
			    				        }
			    				    }else{
			    				    	list.push(item)
			    				    }
			    				    return list
			    				},[]).map((e,i) => i == 0 ? 
										e = e : 
    										e = ''.padStart(7,'\t') + e
    								).join('\n')
			    							    				
			    				if(thisPageIsExist){
			    					setting.cottonQuestions.questionsList[nowPageValue - 1] = resultQuestions;
			    					setting.cottonQuestions.answers[nowPageValue - 1] = `${setting.chatSeparator}${answer.value}`;
			    					nowPage.textContent = `${nowPageValue + 1}`.padStart(2,'0');
			    					if(setting.thisPageIsExist(nowPageValue, [setting.cottonQuestions.questionsList, setting.cottonQuestions.answers])
			    						){
			    						cottonQuestionsPagingProcess(questionsWrapper.querySelector('#cotton_questions_right_page'), 1);
			    					}else{
			    						questionsTextDelete(title, questionsArr, answer);
				    					nowPage.textContent = `${nowPageValue + 1}`.padStart(2,'0');
			    					}
			    					return false;
			    				}else{
			    					setting.cottonQuestions.questionsList.push(resultQuestions);
			    					setting.cottonQuestions.answers.push(`#${answer.value}`);
			    					questionsTextDelete(title, questionsArr, answer)
					    			nowPage.textContent = `${nowPageValue + 1}`.padStart(2,'0');
					    			maxPage.textContent = `${maxPageValue + 1}`.padStart(2,'0');
			    				}
			    			}
			    			function questionsTextDelete(...element){
			    				element.map(e=>e.value='');
			    			}
			    		</script>
					</div>
				</div>
				<div class="cotton_questions_paging" style="display: flex;justify-content: space-around;font-size: 3vmax;">
					<button type="button" id="cotton_questions_left_page" onclick="cottonQuestionsPagingProcess(this, -1)" style="font-size: 3vmax; cursor: pointer;">
						&lt;
					</button>
					<div style="display: flex;gap: 15%;justify-content: center;"><i id="cotton_questions_page">01</i><i>/</i><i id="cotton_questions_max_page">01</i></div>
					<button type="button" id="cotton_questions_right_page" onclick="cottonQuestionsPagingProcess(this, 1)" style="font-size: 3vmax; cursor: pointer;">
						&gt;
					</button>
					<script type="text/javascript">
						function cottonQuestionsPagingProcess(obj, addNumber){
		    				let questionsWrapper = obj.offsetParent;
		    				let questionsContent = questionsWrapper.querySelector('.cotton_questions_content');
		    				let title = questionsWrapper.querySelector('input#title');
		    				let questionsArr = questionsWrapper.querySelector('textarea#questions');
		    				let answer = questionsWrapper.querySelector('input#answer');
		    				
		    				let maxPage = Number(questionsWrapper.querySelector('#cotton_questions_max_page').textContent);
							let nowPage = Number(questionsWrapper.querySelector('#cotton_questions_page').textContent);
							let paging = nowPage + addNumber;
							if(paging < 1){
								paging = maxPage;
							}else if(paging > maxPage){
								paging = 1;
							}

							questionsWrapper.querySelector('#cotton_questions_page').textContent = `${paging}`.padStart(2,'0') ;
							paging = paging - 1
							console.log(paging);
							if(setting.cottonQuestions.questionsList.hasOwnProperty(paging) && 
								setting.cottonQuestions.answers.hasOwnProperty(paging)
							){
								textArr = setting.cottonQuestions.questionsList[paging].split('\n')
								title.value = textArr[0];
								questionsArr.value = textArr.map((e,i) => i == 0 ? '' : e.replaceAll('\t','')).join('\n').substring(1);
								answer.value = setting.cottonQuestions.answers[paging].substring(1);
							}else{
								title.value = ''
								questionsArr.value = ''
								answer.value = ''
							}
						}
					</script>
				</div>
			</div>
		</div>
		<!-- /layer -->

	</div>
	<div style="position: absolute; display: 'flex'; top: '1vh'; left: '-2vw'; gap: '1.2vw'; z-index: 1; width: 60%; height: 60%;">
		<canvas id="renderCanvas" style="touch-action: none; outline: none; width: 100%; height: 100%;" tabindex="1">
		</canvas>
		<div id="chat_questions_view_wrapper" style="background-color: #ffffff99;height: 45%;display: none;">
			<div class="chat_questions_view_item_wrapper">
			</div>
			<div class="chat_questions_view_item_wrapper">
			</div>
			<script type="text/javascript">
				var chatQuestionsViewWrapper = document.querySelector('#chat_questions_view_wrapper');
				var chatQuestionsViewItemWrapper = chatQuestionsViewWrapper.querySelectorAll('.chat_questions_view_item_wrapper')
				var chatQuestionsChatGraph;
				var questionUserSelectNumber;
				function createChatWrapper(){
					if(canvas.hasAttribute('is_canvas_run') === false ||
						canvas.getAttribute('is_canvas_run') === 'N'
					){
						return;
					}
					setting.nowQuestionsInfo = {}
					chatQuestionsViewWrapper.style.display = 'flex';
					let questionsObj = setting[setting.gameSelectKey];
					let page = questionsObj.page;
					let questionsList = questionsObj.questionsList[page - 1].split('\n')
					let questionsTilte = questionsList.splice(0,1)
					setting.nowQuestionsInfo.all = [];
					questionsItemHtml = questionsList.map(e=>{
						let questionsText = e.replaceAll('\t','')
						let questionsUserSelect = questionsText.charAt(0);
						
						questionsText = questionsText.substring(3);
						/*
						let questionsItem = `
											<label class="questions_user_select" data-text_value="${questionsText}">${questionsUserSelect}</label>
											<span class="questions_user_select_number">0</span>
											<svg class="chat_questions_chart">
												<rect class="chat_questions_chart_graph" fill="${getRandomColor()}">
											</svg>
											`
						*/
						let label = Object.assign( document.createElement('label'), {className : "questions_user_select", textContent : questionsUserSelect} );
						label.setAttribute('data-text_value', questionsText)
						let span = Object.assign( document.createElement('span'), {className : "questions_user_select_number", textContent: 0});
						let chartWrapper = Object.assign( document.createElement('div'), {className : "chat_questions_chart"});
						let chartGraph = Object.assign( document.createElement('div'), {className : "chat_questions_chart_graph"});
						chartWrapper.append(chartGraph);
						Object.assign(chartGraph.style,{backgroundColor:getRandomColor(),width:'0%'});
						
						let div = Object.assign(document.createElement('div'),{className:'chat_questions_chart_statistics_wrapper'});
						div.append(...[label, span, chartWrapper]);
						
						let obj = {'chartValueHTML' : chartGraph, 'userSelectCountHTML' : span, 'chartValue' : 0, 'userSelectCount' : 0};
						setting.nowQuestionsInfo[questionsUserSelect] = obj;
						setting.nowQuestionsInfo[questionsText] = obj;
						setting.nowQuestionsInfo.all.push(obj);
						return div;
					});
					
					chatQuestionsViewItemWrapper.forEach(e=>e.replaceChildren(...questionsItemHtml.splice(0,4)))
				}
				
				function questionsRecordSave(title, [...data]){
					while(questionsRecord.hasOwnProperty(title) == true){
						title = title + '_';
					}
					setting.questionsRecord[title] = data.reduce((t,e,i)=>{
						
					},{})
				}
				
			 </script>
		</div>
    </div>
	<script type="text/javascript">
	    var rgbTransForm = (rgb = [0,0,0]) => rgb.map(e=>e/256);
	    
        const canvas = document.getElementById("renderCanvas");

        const engine = new BABYLON.Engine(canvas, true);
        
        var clickEvt = false;
        
        var legalPad;
        var text = [''];
        var scene;
        var padQuestionInfo;
        var testCamera;
		var createScene;
		function View3DCreate() {
	        //공간 선언
	        scene = new BABYLON.Scene(engine);
	        scene.autoClear = false
	        //공간 배경 색상 설정
	        scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);

	        //카메라의 3차원 위치 설정
	        const alpha =  Math.PI/-2;
	        const beta = Math.PI/3; 
	        const radius = 17;
	        const target = new BABYLON.Vector3(0, 5, 5);
	            
	        //카메라의 초기 위치 셋팅
	        const camera = new BABYLON.ArcRotateCamera("Camera", alpha, beta, radius, target, scene);
	        camera.attachControl(canvas, true);
	        camera.setTarget(BABYLON.Vector3.Zero());
	        camera.speed = 0.5
	        testCamera = camera;
	        //광원 생성
	        const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));
	        
	        legalPad = BABYLON.SceneLoader.ImportMeshAsync(null, "/model/","LegalPad_6.glb")//.then(e=>e.meshes[0].position.x = 15);

	        var page = 1;
	        var maxPage = 1;
	        if(setting.gameSelectKey == 'devQuestions'){
	        	page = setting.devQuestions.page;
	        	maxPage = setting.devQuestions.questionsList.length;
	        	text = setting.devQuestions.questionsList[page - 1].split('\n');
	        }else if(setting.gameSelectKey == 'cottonQuestions'){
	        	page = setting.cottonQuestions.page;
	        	maxPage = setting.cottonQuestions.questionsList.length;
	        	text = setting.cottonQuestions.questionsList[page - 1].split('\n');
	        }
	        padQuestionInfo = createText();
	    	var font = "bold 100px monospace";
	    	
	        var groundWidth = 4;
	        var groundHeight = 2;
	        
	        var groundNextText = BABYLON.MeshBuilder.CreateGround("next", {width: groundWidth, height: groundHeight, subdivisions: 25}, scene);
	        var textureNextText = new BABYLON.DynamicTexture("dynamic texture", {width:256, height:128}, scene);
	        textureNextText.getContext();
	        var materialNextText = new BABYLON.StandardMaterial("Mat", scene);
	        materialNextText.diffuseTexture = textureNextText;
	        groundNextText.material = materialNextText;
	        textureNextText.drawText("Next", 25, 100, font, "black", "white", true, true);
	        groundNextText.position.y = 0.5;
	        groundNextText.position.x = 6;
	        groundNextText.position.z = -5;
	        groundNextText.visibility = 1
	        
	        var groundPrevText = BABYLON.MeshBuilder.CreateGround("prev", {width: groundWidth, height: groundHeight, subdivisions: 25}, scene);;
	        var texturePrevText = new BABYLON.DynamicTexture("dynamic texture", {width:256, height:128}, scene);
	        texturePrevText.getContext();
	        var materialPrevText = new BABYLON.StandardMaterial("Mat", scene);
	        materialPrevText.diffuseTexture = texturePrevText;
	        groundPrevText.material = materialPrevText;
	        texturePrevText.drawText("Prev", 25, 100, font, "black", "white", true, true);
	        groundPrevText.position.y = 0.5
	        groundPrevText.position.x = -6;
	        groundPrevText.position.z = -5;
	        groundPrevText.visibility = 1
	        
	        var groundPagingText =  BABYLON.MeshBuilder.CreateGround("paging", {width: groundWidth, height: groundHeight, subdivisions: 25}, scene);;
	        var texturePagingText = new BABYLON.DynamicTexture("dynamic texture", {width:256, height:128}, scene);
	        texturePagingText.getContext();
	        var materialPagingText = new BABYLON.StandardMaterial("Mat", scene);
	        materialPagingText.diffuseTexture = texturePagingText;
	        groundPagingText.material = materialPagingText;
	        texturePagingText.drawText(`${page.toString().padStart(2,'0')}/${maxPage.toString().padStart(2,'0')}`, 12, 100, "bold 90px monospace", "black", "white", true, true);
	        groundPagingText.position.y = 0.5
	        groundPagingText.position.x = 0;
	        groundPagingText.position.z = -5;
	        groundPagingText.visibility = 1
	        
	        var groundVideoStart = BABYLON.MeshBuilder.CreateGround("video_start_button", {width: 2, height: 1, subdivisions: 25}, scene);;
	        var textureVideoStart = new BABYLON.DynamicTexture("dynamic texture", {width:256, height:128}, scene);
	        textureVideoStart.getContext();
	        var materialVideoStart = new BABYLON.StandardMaterial("Mat", scene);
	        materialVideoStart.diffuseTexture = textureVideoStart;
	        groundVideoStart.material = materialVideoStart;
	        textureVideoStart.drawText("시작", 60, 95, "bold 70px monospace", "red", "white", true, true);
	        groundVideoStart.position.y = 99999;
	        groundVideoStart.position.x = 6;
	        groundVideoStart.position.z = -2;
	        groundVideoStart.visibility = 0;
	        
	        var groundTimer =  BABYLON.MeshBuilder.CreateGround("timer", {width: 2, height: 1, subdivisions: 25}, scene);;
	        var textureTimer = new BABYLON.DynamicTexture("dynamic texture", {width:512, height:256}, scene);
	        textureTimer.getContext();
	        var materialTimer = new BABYLON.StandardMaterial("Mat", scene);
	        materialTimer.diffuseTexture = textureTimer;
	        groundTimer.material = materialTimer;
	        textureTimer.drawText('문제 시작', 5, 170, "bold 110px monospace", "black", "white", true, true);
	        groundTimer.position.y = 0.5
	        groundTimer.position.x = 4.5;
	        groundTimer.position.z = 6;
	        groundTimer.visibility = 1
	        
	        var groundAnswerSelect =  BABYLON.MeshBuilder.CreateGround("answer_select", {width: 2 , height: 1, subdivisions: 25}, scene);;
	        var textureAnswerSelect= new BABYLON.DynamicTexture("dynamic texture", {width:512, height:256}, scene);
	        textureAnswerSelect.getContext();
	        var materialAnswerSelect= new BABYLON.StandardMaterial("Mat", scene);
	        materialAnswerSelect.diffuseTexture = textureAnswerSelect;
	        groundAnswerSelect.material = materialAnswerSelect;
	        textureAnswerSelect.drawText('정답 선택', 5, 170, "bold 110px monospace", "black", "white", true, true);
	        groundAnswerSelect.position.y = 0.5
	        groundAnswerSelect.position.x = 8;
	        groundAnswerSelect.position.z = 6;
	        groundAnswerSelect.visibility = 1
	        groundAnswerSelect.isAnswerSelect = false;
	        
	        
	        groundNextText.actionManager = new BABYLON.ActionManager(scene);
	        groundNextText.actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
	        	if(timer.isCustomRun){
	        		modalLoader.createModalAlertText(['타이머가 돌고 있습니다.']);
	        		return;
	        	}
	        	let targetQuestions = setting[setting.gameSelectKey];
        		targetQuestions.page++;
	        	
        		if(targetQuestions.type != 2 && targetQuestions.type != -1){
	        		if(targetQuestions.page >= targetQuestions.questionsList.length + 1){
	        			targetQuestions.page = 1;
	        		}
	        		texturePagingText.drawText(`${targetQuestions.page.toString().padStart(2,'0')}/${targetQuestions.questionsList.length.toString().padStart(2,'0')}`, 12, 100, "bold 90px monospace", "black", "white", true, true);
	        		text = targetQuestions.questionsList[targetQuestions.page - 1].split('\n');
	        		padQuestionInfo = createText();
	        		chatQuestionsViewWrapper.style.display = 'none';
	        		if(setting.gameSelectKey == 'devQuestions' && targetQuestions.page == targetQuestions.questionsList.length){
	        			groundVideoStart.visibility = 1;
	        			groundVideoStart.position.y = 0.5;
	        			chatQuestionsViewItemWrapper.forEach(e=>e.replaceChildren());
	        		}else{
	        			groundVideoStart.visibility = 0;
	        			groundVideoStart.position.y = 99999;
	        		}
	        	}
	        }));
	        groundPrevText.actionManager = new BABYLON.ActionManager(scene);
	        groundPrevText.actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
	        	if(timer.isCustomRun){
	        		modalLoader.createModalAlertText(['타이머가 돌고 있습니다.']);
	        		return;
	        	}
	        	let targetQuestions = setting[setting.gameSelectKey];
        		targetQuestions.page--;
	        	if(targetQuestions.type != 2 && targetQuestions.type != -1){
	        		if(targetQuestions.page < 1){
	        			targetQuestions.page = targetQuestions.questionsList.length;
	        		}
	        		texturePagingText.drawText(`${targetQuestions.page.toString().padStart(2,'0')}/${targetQuestions.questionsList.length.toString().padStart(2,'0')}`, 12, 100, "bold 90px monospace", "black", "white", true, true);
	        		text = targetQuestions.questionsList[targetQuestions.page - 1].split('\n');
	        		padQuestionInfo = createText();
	        		chatQuestionsViewWrapper.style.display = 'none';
	        		if(setting.gameSelectKey == 'devQuestions' && targetQuestions.page == targetQuestions.questionsList.length){
	        			groundVideoStart.visibility = 1;
	        			groundVideoStart.position.y = 0.5;
	        			chatQuestionsViewItemWrapper.forEach(e=>e.replaceChildren());
	        		}else{
	        			groundVideoStart.visibility = 0;
	        			groundVideoStart.position.y = 99999;
	        		}
	        	}
	        }));
	        
	        groundVideoStart.actionManager = new BABYLON.ActionManager(scene);
	        groundVideoStart.actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
	        	console.log(evt);
	        }));
	        
	        groundAnswerSelect.actionManager = new BABYLON.ActionManager(scene);
	        groundAnswerSelect.actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
	        	if(groundAnswerSelect.isAnswerSelect == false){
		        	groundAnswerSelect.isAnswerSelect = true;
		        	cameraSetAndDetach(camera);
		        	console.log(evt);
		        	textureAnswerSelect.drawText('선택 취소', 5, 170, "bold 110px monospace", "black", "white", true, true);
	        	}else if(groundAnswerSelect.isAnswerSelect == true){
	        		groundAnswerSelect.isAnswerSelect = false;
	        		camera.attachControl(canvas, true);
	        		textureAnswerSelect.drawText('정답 선택', 5, 170, "bold 110px monospace", "black", "white", true, true);
	        	}
	        }));
	        
	        groundTimer.actionManager = new BABYLON.ActionManager(scene);
	        groundTimer.actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
	        	let timerLayer = document.querySelector('#timer_setting_layer');
	        	if(timer.inputMinute == 0){
	        		timerLayer.style.display='flex';
	        	}else{
	        		timer.setCustomTimer(timerLayer);
	        	}
	        }));
	        
            const xrPromise = scene.createDefaultXRExperienceAsync({
                floorMeshes: [legalPad]
            });
	        return xrPromise.then((xrExperience) => {
	        	console.log("Done, WebXR is enabled.");
	            return scene;
			});
	        function createVideoStartButton(command){

	        }
	        function cameraSetAndDetach(camera){
	        	/*
		        알파 : -1.5915287647531062
		        베타 : 0.012399993896484374
		        radius : 16.636576611690444
		        target = 0 0 0
		        */
	        	camera.alpha = -1.570661301086402;
	        	camera.beta = 0.001;
	        	camera.radius = 16.636576611690444;
	        	camera.target.x = 0;
	        	camera.target.y = 0;
	        	camera.target.z = 0;
	        	camera.detachControl();
	        }
        };

        function createText(){
   			let result = [];
        	legalPad.then(pad=>{
	        	let heightLine = 380;
       			let index = 0
       			for(let i = 2 ; i < pad.meshes.length ; i++){
       				let viewText = text.hasOwnProperty(index) ? text[index] : '';
       				heightLine = heightLine + 50
       				var padDynamicTexture = new BABYLON.DynamicTexture("PadDynamicTexture", {width:2064, height:1032}, scene);
        			padDynamicTexture.getContext();
       				padDynamicTexture.drawText(viewText, 870, heightLine, "bold 30px comic", "#000000", "transparent", false, true);
        			var mat = new BABYLON.StandardMaterial("Mat", scene);
    		        mat.diffuseTexture = padDynamicTexture;
    		        mat.diffuseTexture.hasAlpha = true;
    		        pad.meshes[i].material = mat;
    		        pad.meshes[i].questionEventHeightValue = heightLine;
    		        pad.meshes[i].questionTextValue = viewText;
    		        pad.meshes[i].actionManager = new BABYLON.ActionManager(scene);
    		        pad.meshes[i].actionManager.registerAction( new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, (evt) => {
    		        	console.log(Math.floor(evt.pointerY/32) - 2 )
    		        	console.log(padQuestionInfo[Math.floor(evt.pointerY/32) - 2])
    		        }));
    		        index++;
    		        result.push(pad.meshes[i]);
       			}
        	});
        	return result;
        }

		function startGame(obj){
			if(setting.gameSelectKey == - 1 ){
				modalLoader.createModalAlertText(['게임을 셋팅해주세요.']);
				setting.isStartGame = false;
				return;
			}else if(setting.gameSelectKey == 'cottonQuestions' && setting.cottonQuestions.questionsList.length == 0){
				modalLoader.createModalAlertText(['문제를 만들어주세요']);
				setting.isStartGame = false;
				return;
			}
			
			if(canvas.hasAttribute('is_canvas_run') === false){
		        createScene = View3DCreate();
		        createScene.then(sceneToRender => {
		            engine.runRenderLoop(() => sceneToRender.render());
		            canvas.setAttribute('is_canvas_run', 'Y')
		        });
				obj.textContent = '게임 on'
				setting.isStartGame = true;
			}else if(canvas.getAttribute('is_canvas_run') === 'N'){
		        createScene = View3DCreate();
		        createScene.then(sceneToRender => {
		            engine.runRenderLoop(() => sceneToRender.render());
		            canvas.setAttribute('is_canvas_run', 'Y')
		        });
				canvas.style.display = 'flex';
				//let targetQuestions = setting[setting.gameSelectKey];
				//text = targetQuestions.questionsList[targetQuestions.page - 1].split('\n');
				//padQuestionInfo = createText();
				obj.textContent = '게임 on'
				setting.isStartGame = true;
			}else if(canvas.getAttribute('is_canvas_run') === 'Y'){
				createScene.then(sceneToRender=>sceneToRender.dispose());
				canvas.style.display = 'none';
				canvas.setAttribute('is_canvas_run', 'N')
				obj.textContent = '게임 off'
				setting.isStartGame = false;
			}
		}
		function reloadScene(){
			if(canvas.getAttribute('is_canvas_run') === 'Y'){
				createScene.then(sceneToRender=>{
					sceneToRender.dispose();
					createScene = View3DCreate();
				}).then(()=>{
					createScene.then(sceneToRender => {
			            engine.runRenderLoop(() => sceneToRender.render());
			        });
				});
			}
		}
	</script>
	<div id="video_wrapper" style="display: none;">
		<video id="video_now" src="video/criticism/question_criticism.mp4" style="position: absolute;width: 100%;height: 100%;top: 0;left: 0;background: black;">
     	</video>
		<label style="position: absolute;right: -4vh;top: 13vh;transform: rotate(-90deg);">
    			<input type="range" min="0" max="1" value="1" step="0.1" onchange="volumeController(this)" oninput="volumeController(this)">
    			<img src="images/volume.png" style="width: 2vw;height: 3vh;transform: rotate(90deg);">
   		</label>
   		<script type="text/javascript">
   			function volumeController(obj){
   				obj.parentElement.querySelector('#video_now').volume = obj.value;
   			}
   		</script>
  		<div id="video_question_wrapper" style="width:100%; height:100%; background-color:black; opacity:0.4; position:absolute; display:none;">
  			<div id=video_question_select>
  			</div>
  			<div id=video_question_select>
  			</div>
  			<div id=video_question_select>
  			</div>
   		</div>
   		<script type="text/javascript">
   			function videoQuestionStart(){
   				canvas.setAttribute('is_canvas_run', 'Y');
   				startGame(document.querySelector('#game_start_button'));
   				
   			}
   		</script>
   	</div>
</body>
</html>